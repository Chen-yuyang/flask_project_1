{% extends "base.html" %}

{% block title %}首页 - 物品管理系统{% endblock %}

{% block content %}
<!-- 欢迎区域 -->
<div class="jumbotron bg-light p-4 rounded-3 mt-3">
    <h1 class="display-4">欢迎使用物品管理系统</h1>
    <p class="lead">支持多级空间管理、物品借用跟踪、预约管理及逾期提醒，助力高效物品管理。</p>
    <hr class="my-4">

    <!-- 登录/未登录展示不同内容 -->
    {% if current_user.is_authenticated %}
    <p class="mb-3">当前角色：<strong>{{ '管理员' if current_user.is_admin() else '普通用户' }}</strong></p>
    <div class="d-flex flex-wrap gap-2">
        <a class="btn btn-primary btn-lg" href="{{ url_for('spaces.index') }}" role="button">空间管理</a>
        <a class="btn btn-secondary btn-lg" href="{{ url_for('items.all_items') }}" role="button">所有物品</a>
        <a class="btn btn-success btn-lg" href="{{ url_for('records.my_records') }}" role="button">我的记录</a>
        <a class="btn btn-info btn-lg" href="{{ url_for('reservations.my_reservations') }}" role="button">我的预约</a>
    </div>
    {% else %}
    <p class="mb-3">请登录后使用系统全部功能</p>
    <div class="d-flex gap-2">
        <a class="btn btn-primary btn-lg" href="{{ url_for('auth.login') }}" role="button">登录</a>
        <a class="btn btn-success btn-lg" href="{{ url_for('auth.register') }}" role="button">注册</a>
    </div>
    {% endif %}
</div>

<!-- 已登录用户的数据卡片 -->
{% if current_user.is_authenticated %}
<div class="row mt-5 gap-4">
    <!-- 最近使用记录 -->
    <div class="col-md-6">
        <div class="card shadow h-100">
            <div class="card-header bg-primary text-white">
                <h5 class="card-title mb-0">最近使用的物品</h5>
            </div>
            <div class="card-body">
                {% if recent_records %}
                <ul class="list-group">
                    {% for record in recent_records %}
                    <li class="list-group-item d-flex justify-content-between align-items-center">
                        <a href="{{ url_for('items.view', id=record.item.id) }}">{{ record.item.name }}</a>
                        <span class="badge bg-{{ 'warning' if record.status == 'using' else 'success' }}">
                            {{ '使用中' if record.status == 'using' else '已归还' }}
                        </span>
                    </li>
                    {% endfor %}
                </ul>
                {% else %}
                <p class="text-muted text-center">暂无使用记录</p>
                {% endif %}
            </div>
        </div>
    </div>

    <!-- 我的预约 -->
    <div class="col-md-6">
        <div class="card shadow h-100">
            <div class="card-header bg-info text-white">
                <h5 class="card-title mb-0">我的预约</h5>
            </div>
            <div class="card-body">
                {% if my_reservations %}
                <ul class="list-group">
                    {% for reservation in my_reservations %}
                    <li class="list-group-item">
                        <a href="{{ url_for('items.view', id=reservation.item.id) }}">{{ reservation.item.name }}</a>
                        <small class="d-block text-muted mt-1">
                            {{ reservation.reservation_start.strftime('%Y-%m-%d') }} 至 {{ reservation.reservation_end.strftime('%Y-%m-%d') }}
                        </small>
                    </li>
                    {% endfor %}
                </ul>
                {% else %}
                <p class="text-muted text-center">暂无预约记录</p>
                {% endif %}
            </div>
        </div>
    </div>
</div>
{% endif %}
{% endblock %}